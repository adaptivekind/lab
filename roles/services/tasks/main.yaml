- name: Get cluster certificate pem
  shell: "openssl s_client -showcerts -connect devon:443 </dev/null 2>/dev/null|openssl x509 -outform PEM > /etc/caddy/cluster.pem"
  args:
    creates: /etc/caddy/cluster.pem

- name: Register ArgoCD service
  copy:
    src: argocd.caddy
    dest: /etc/caddy/sites-enabled/
  notify: Reload Caddy

- name: Register Traefik service
  copy:
    src: traefik.caddy
    dest: /etc/caddy/sites-enabled/
  notify: Reload Caddy
