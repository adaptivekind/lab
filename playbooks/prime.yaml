- name: Initialize prime host
  hosts: prime
  become: yes
  serial: 1
  collections:
    - adaptivekind.lab
  vars:
    # Prometheus configuration - /etc/prometheus
    # https://github.com/prometheus-community/ansible/blob/main/roles/prometheus/defaults/main.yml
    prometheus_remote_write:
    - url: https://{{ prometheus_remote_write_host }}/api/prom/push
      basic_auth:
        username: "{{ prometheus_write_username }}" # e.g. Grafana Instance ID
        password: "{{ prometheus_write_api_key }}"
      queue_config:
        max_backoff: "60s"
        sample_age_limit: "1h"
        max_samples_per_send: 5000
  roles:
    - role: crypt
      tags: crypt
    - role: git
      tags: git
    - role: go
      tags: go
    - role: caddy
      tags: caddy
    - role: prometheus.prometheus.prometheus
      tags: prometheus
    - role: prometheus.prometheus.node_exporter
      tags: prometheus
    - role: prometheus
      tags: prometheus
    - role: docker
      tags: docker
    - role: pihole
      tags: pihole
    - role: nfs
      tags: nfs
    - role: wireguard
      tags: vpn
    - role: services
      tags: services

